# Module 3.1 - è‡ªå®šä¹‰å·¥å…·è¯¦è§£

> **å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ï¼Œè®© Agent æ‹¥æœ‰é¢†åŸŸç‰¹å®šçš„èƒ½åŠ›ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å·¥å…·ï¼Ÿ

### é—®é¢˜åœºæ™¯

åœ¨ Module 2 ä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šäº†ä½¿ç”¨å†…ç½®çš„ Readã€Writeã€Bash å·¥å…·ã€‚ä½†ä½ å¯èƒ½å‘ç°ï¼š

- **å±€é™ 1**ï¼šå†…ç½®å·¥å…·èƒ½åŠ›æœ‰é™
  - ä¾‹å¦‚ï¼šæƒ³è¦è§£æ PDF æ–‡ä»¶ â†’ æ²¡æœ‰å†…ç½®çš„ PDF å·¥å…·
- **å±€é™ 2**ï¼šæ— æ³•è¿æ¥å¤–éƒ¨æœåŠ¡
  - ä¾‹å¦‚ï¼šæƒ³æŸ¥è¯¢æ•°æ®åº“ â†’ éœ€è¦è‡ªå®šä¹‰æ•°æ®åº“å·¥å…·
- **å±€é™ 3**ï¼šè¾“å‡ºæ ¼å¼ä¸å¯æ§
  - ä¾‹å¦‚ï¼šæƒ³è¦ JSON æ ¼å¼çš„ç»“æ„åŒ–æ•°æ®

### è§£å†³æ–¹æ¡ˆï¼šè‡ªå®šä¹‰å·¥å…·

**è‡ªå®šä¹‰å·¥å…·** è®©ä½ å¯ä»¥ä¸º Agent æ·»åŠ ä»»æ„èƒ½åŠ›ï¼š

```
å®šä¹‰å·¥å…· â†’ æ³¨å†Œåˆ°æœåŠ¡å™¨ â†’ Agent è°ƒç”¨ â†’ è¿”å›ç»“æœ
```

---

## æ˜¯ä»€ä¹ˆï¼Ÿ

### æ ¸å¿ƒæ¦‚å¿µ

**è‡ªå®šä¹‰å·¥å…·** æ˜¯ä½ å®šä¹‰çš„å‡½æ•°ï¼ŒAgent å¯ä»¥åƒä½¿ç”¨å†…ç½®å·¥å…·ä¸€æ ·è°ƒç”¨å®ƒä»¬ã€‚

| ç»„ä»¶ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `@tool` è£…é¥°å™¨ | å®šä¹‰å·¥å…· | `@tool("add", ...)` |
| `create_sdk_mcp_server` | åˆ›å»ºå·¥å…·æœåŠ¡å™¨ | å°†å·¥å…·æ‰“åŒ…æˆæœåŠ¡ |
| `mcp_servers` | æ³¨å†ŒæœåŠ¡å™¨ | åœ¨é€‰é¡¹ä¸­å¯ç”¨ |

### @tool è£…é¥°å™¨

```python
from claude_agent_sdk import tool

@tool(
    name="calculator",           # å·¥å…·åç§°
    description="æ‰§è¡Œæ•°å­¦è®¡ç®—",   # æè¿°ï¼ˆAgent ç”¨æ¥åˆ¤æ–­ä½•æ—¶è°ƒç”¨ï¼‰
    params={"expression": str}   # å‚æ•°å®šä¹‰
)
async def calculator(args: dict) -> dict:
    """å·¥å…·å®ç°"""
    result = eval(args["expression"])
    return {
        "content": [{"type": "text", "text": f"ç»“æœ: {result}"}]
    }
```

### å·¥å…·å‘½åè§„åˆ™

Agent è°ƒç”¨è‡ªå®šä¹‰å·¥å…·æ—¶ä½¿ç”¨ç‰¹å®šæ ¼å¼ï¼š

```
mcp__<æœåŠ¡å™¨å>__<å·¥å…·å>

ä¾‹å¦‚ï¼š
- mcp__calc__add        â†’ calc æœåŠ¡å™¨çš„ add å·¥å…·
- mcp__resume__parse    â†’ resume æœåŠ¡å™¨çš„ parse å·¥å…·
```

---

## å¦‚ä½•å·¥ä½œï¼Ÿ

### å·¥å…·è°ƒç”¨æµç¨‹

```
1. ç”¨æˆ·è¯·æ±‚
   "å¸®æˆ‘è®¡ç®— 15 * 23"
        â†“
2. Agent åˆ†æ
   "éœ€è¦ä½¿ç”¨ calculator å·¥å…·"
        â†“
3. å·¥å…·è°ƒç”¨
   Tool: mcp__calc__calculator
   Input: {"expression": "15 * 23"}
        â†“
4. ä½ çš„å‡½æ•°æ‰§è¡Œ
   result = eval("15 * 23")  # = 345
        â†“
5. è¿”å›ç»“æœ
   {"content": [{"type": "text", "text": "ç»“æœ: 345"}]}
        â†“
6. Agent å›å¤
   "15 ä¹˜ä»¥ 23 çš„ç»“æœæ˜¯ 345"
```

### å®Œæ•´ç¤ºä¾‹

```python
from claude_agent_sdk import (
    tool,
    create_sdk_mcp_server,
    ClaudeAgentOptions,
    query
)

# 1. å®šä¹‰å·¥å…·
@tool("add", "Add two numbers", {"a": float, "b": float})
async def add(args):
    result = args["a"] + args["b"]
    return {"content": [{"type": "text", "text": f"{result}"}]}

@tool("multiply", "Multiply two numbers", {"a": float, "b": float})
async def multiply(args):
    result = args["a"] * args["b"]
    return {"content": [{"type": "text", "text": f"{result}"}]}

# 2. åˆ›å»ºæœåŠ¡å™¨
calculator = create_sdk_mcp_server(
    name="calc",
    version="1.0.0",
    tools=[add, multiply]
)

# 3. é…ç½®é€‰é¡¹
options = ClaudeAgentOptions(
    mcp_servers={"calc": calculator},
    allowed_tools=["mcp__calc__add", "mcp__calc__multiply"]
)

# 4. ä½¿ç”¨
async for msg in query("è®¡ç®— 5 + 3 ç„¶åä¹˜ä»¥ 2", options=options):
    print(msg)
```

---

## ç»“æ„åŒ–è¾“å‡º

### ä¸ºä»€ä¹ˆéœ€è¦ç»“æ„åŒ–è¾“å‡ºï¼Ÿ

æ™®é€šè¾“å‡ºæ˜¯è‡ªç”±æ–‡æœ¬ï¼Œéš¾ä»¥ç¨‹åºå¤„ç†ï¼š

```
Agent: è¿™ä»½ç®€å†çš„å€™é€‰äººå«å¼ ä¸‰ï¼Œæœ‰5å¹´Pythonç»éªŒ...
```

ç»“æ„åŒ–è¾“å‡ºæ˜¯å¯è§£æçš„ JSONï¼š

```json
{
  "name": "å¼ ä¸‰",
  "experience": 5,
  "skills": ["Python", "JavaScript"]
}
```

### JSON Schema è¾“å‡º

```python
from claude_agent_sdk import query, ClaudeAgentOptions

# å®šä¹‰è¾“å‡ºæ ¼å¼
schema = {
    "type": "object",
    "properties": {
        "name": {"type": "string"},
        "skills": {"type": "array", "items": {"type": "string"}},
        "years": {"type": "integer"}
    },
    "required": ["name", "skills"]
}

options = ClaudeAgentOptions(
    output_format={
        "type": "json_schema",
        "schema": schema
    }
)

async for msg in query("åˆ†æè¿™ä»½ç®€å†...", options=options):
    if hasattr(msg, 'structured_output'):
        data = msg.structured_output  # å·²éªŒè¯çš„ JSON
        print(f"å§“å: {data['name']}")
        print(f"æŠ€èƒ½: {data['skills']}")
```

---

## å·¥å…·å‚æ•°ç±»å‹

### æ”¯æŒçš„ç±»å‹

| Python ç±»å‹ | JSON Schema | ç¤ºä¾‹ |
|------------|-------------|------|
| `str` | `string` | `"text": str` |
| `int` | `integer` | `"count": int` |
| `float` | `number` | `"price": float` |
| `bool` | `boolean` | `"enabled": bool` |
| `list` | `array` | `"items": list` |
| `dict` | `object` | `"config": dict` |

### å¤æ‚å‚æ•°ç¤ºä¾‹

```python
@tool(
    "analyze_data",
    "Analyze data with options",
    {
        "data": list,           # åˆ—è¡¨
        "options": {            # åµŒå¥—å¯¹è±¡
            "format": str,
            "verbose": bool
        }
    }
)
async def analyze_data(args):
    data = args["data"]
    format = args["options"]["format"]
    # ...
```

---

## é”™è¯¯å¤„ç†

### è¿”å›é”™è¯¯

```python
@tool("divide", "Divide two numbers", {"a": float, "b": float})
async def divide(args):
    if args["b"] == 0:
        return {
            "content": [{"type": "text", "text": "é”™è¯¯: é™¤æ•°ä¸èƒ½ä¸º0"}],
            "is_error": True  # æ ‡è®°ä¸ºé”™è¯¯
        }
    
    result = args["a"] / args["b"]
    return {"content": [{"type": "text", "text": f"{result}"}]}
```

### Agent å¦‚ä½•å¤„ç†é”™è¯¯

å½“å·¥å…·è¿”å› `is_error: True` æ—¶ï¼š
- Agent ä¼šçœ‹åˆ°é”™è¯¯ä¿¡æ¯
- Agent å¯èƒ½å°è¯•å…¶ä»–æ–¹æ³•æˆ–å‘ç”¨æˆ·è§£é‡Š

---

## ä½¿ç”¨åœºæ™¯

### âœ… é€‚åˆè‡ªå®šä¹‰å·¥å…·çš„åœºæ™¯

**åœºæ™¯ 1ï¼šå¤–éƒ¨ API é›†æˆ**
- æŸ¥è¯¢å¤©æ°” API
- è°ƒç”¨ç¿»è¯‘æœåŠ¡
- è®¿é—®æ•°æ®åº“

**åœºæ™¯ 2ï¼šæ–‡ä»¶å¤„ç†**
- è§£æ PDF/Word æ–‡æ¡£
- å¤„ç†å›¾ç‰‡
- è½¬æ¢æ•°æ®æ ¼å¼

**åœºæ™¯ 3ï¼šä¸šåŠ¡é€»è¾‘**
- è®¡ç®—ä»·æ ¼
- éªŒè¯æ•°æ®
- ç”ŸæˆæŠ¥å‘Š

**åœºæ™¯ 4ï¼šç»“æ„åŒ–æ•°æ®æå–**
- è§£æç®€å†
- æå–å‘ç¥¨ä¿¡æ¯
- åˆ†ææ—¥å¿—

---

## å…³é”®è¦ç‚¹

âœ… **è®°ä½è¿™äº›**ï¼š
1. `@tool` è£…é¥°å™¨å®šä¹‰å·¥å…·
2. `create_sdk_mcp_server` åˆ›å»ºæœåŠ¡å™¨
3. å·¥å…·åæ ¼å¼ï¼š`mcp__æœåŠ¡å™¨__å·¥å…·å`
4. ä½¿ç”¨ `output_format` è·å–ç»“æ„åŒ–è¾“å‡º

---

## ä¸‹ä¸€æ­¥

âœ… ç»§ç»­é˜…è¯»ï¼š
- **[02_ä»£ç ç¤ºä¾‹.md](02_ä»£ç ç¤ºä¾‹.md)** - å®Œæ•´ä»£ç ç¤ºä¾‹
- **[03_æœ€ä½³å®è·µ.md](03_æœ€ä½³å®è·µ.md)** - å·¥å…·è®¾è®¡åŸåˆ™

ğŸ—ï¸ **å®æˆ˜é¡¹ç›®**ï¼š
å‰å¾€ [project_01_resume_analyzer](../projects/project_01_resume_analyzer/) å®ç°ç®€å†åˆ†æåŠ©æ‰‹ï¼
