# Module 5.2 - MCP 代码示例

> **学习目标**：掌握 MCP Server 的定义方式与客户端调用流程。

## 示例：Notes MCP Server

### 1) 定义工具

```python
from claude_agent_sdk import tool, create_sdk_mcp_server

@tool("add_note", "Add a note", {"title": str, "body": str})
async def add_note(args):
    ...

@tool("list_notes", "List notes", {})
async def list_notes(args):
    ...

notes_server = create_sdk_mcp_server(
    name="notes",
    version="1.0.0",
    tools=[add_note, list_notes]
)
```

### 2) 在客户端启用 MCP

```python
from claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions

options = ClaudeAgentOptions(
    mcp_servers={"notes": notes_server},
    allowed_tools=[
        "mcp__notes__add_note",
        "mcp__notes__list_notes",
    ]
)

client = ClaudeSDKClient(options=options)
```

### 3) 调用流程

```python
prompt = "请新增一条 note：标题是 Onboarding，内容是准备新人环境"
await client.query(prompt=prompt)
```

---

## 示例：输出结构化结果

如果你希望返回 JSON，建议在 tool 里直接返回 JSON 字符串：

```python
return {
    "content": [{"type": "text", "text": json.dumps(data)}]
}
```

客户端可以进一步解析结果。

---

## 工具命名规则

MCP 工具在客户端的调用名称遵循：

```
mcp__<server_name>__<tool_name>
```

例如：
- `mcp__notes__add_note`
- `mcp__notes__list_notes`

---

## 练习建议

- 在工具中加入错误处理（返回 `is_error=True`）
- 为工具添加更明确的参数说明
- 限制 allowed_tools 避免过度授权
