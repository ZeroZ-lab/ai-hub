# Module 2.1 - å·¥å…·ç³»ç»Ÿè¯¦è§£

> **å­¦ä¹ ç›®æ ‡**ï¼šç†è§£ Claude Agent SDK çš„å·¥å…·ç³»ç»Ÿï¼ŒæŒæ¡å¦‚ä½•è®© Agent ä¸æ–‡ä»¶ç³»ç»Ÿå’Œ Shell ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦å·¥å…·ï¼Ÿ

### é—®é¢˜åœºæ™¯

åœ¨ Module 1 ä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šäº†è®© Agent è¿›è¡Œå¯¹è¯ã€‚ä½†ä½ å¯èƒ½å·²ç»å‘ç°ä¸€ä¸ªå±€é™ï¼š

- **é—®é¢˜ 1**ï¼šAgent æ— æ³•çœŸæ­£"çœ‹åˆ°"ä½ çš„æ–‡ä»¶
  - ä¾‹å¦‚ï¼š"è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªé¡¹ç›®çš„ç»“æ„" â†’ Agent åªèƒ½çŒœæµ‹ï¼Œæ— æ³•çœŸæ­£è¯»å–æ–‡ä»¶
- **é—®é¢˜ 2**ï¼šAgent æ— æ³•æ‰§è¡Œä»»ä½•æ“ä½œ
  - ä¾‹å¦‚ï¼š"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶" â†’ Agent åªèƒ½ç»™ä½ ä»£ç ï¼Œä½ éœ€è¦æ‰‹åŠ¨å¤åˆ¶ç²˜è´´
- **é—®é¢˜ 3**ï¼šAgent æ— æ³•è·å–ç³»ç»Ÿä¿¡æ¯
  - ä¾‹å¦‚ï¼š"æ£€æŸ¥æˆ‘çš„ Git çŠ¶æ€" â†’ Agent æ— æ³•æ‰§è¡Œ `git status`

### ä¼ ç»Ÿæ–¹æ¡ˆçš„å±€é™

```python
# âŒ Module 1 çš„æ–¹å¼ï¼šAgent åªèƒ½"è¯´"ï¼Œä¸èƒ½"åš"
response = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    messages=[{"role": "user", "content": "å¸®æˆ‘è¯»å– README.md"}]
)

# Agent åªä¼šå›å¤ï¼š
# "æŠ±æ­‰ï¼Œæˆ‘æ— æ³•ç›´æ¥è¯»å–æ‚¨çš„æ–‡ä»¶ã€‚è¯·æ‚¨å°†å†…å®¹ç²˜è´´ç»™æˆ‘..."
```

### è§£å†³æ–¹æ¡ˆï¼šå·¥å…·ç³»ç»Ÿ

**å·¥å…· (Tools)** æ˜¯è¿æ¥ Agent "æ€è€ƒ" å’Œ "è¡ŒåŠ¨" çš„æ¡¥æ¢ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ Agent æ€è€ƒ â†’ è°ƒç”¨å·¥å…· â†’ è·å–ç»“æœ â†’ Agent å¤„ç† â†’ è¿”å›å“åº”
```

---

## æ˜¯ä»€ä¹ˆï¼Ÿ

### æ ¸å¿ƒå®šä¹‰

**å·¥å…·ç³»ç»Ÿ (Tool System)** æ˜¯è®© Agent èƒ½å¤Ÿæ‰§è¡Œå…·ä½“æ“ä½œçš„æœºåˆ¶ã€‚æ¯ä¸ªå·¥å…·ä»£è¡¨ä¸€ç§èƒ½åŠ›ï¼š

| å·¥å…· | èƒ½åŠ› | ç¤ºä¾‹ |
|------|------|------|
| `Read` | è¯»å–æ–‡ä»¶ | æŸ¥çœ‹ README.md å†…å®¹ |
| `Write` | å†™å…¥æ–‡ä»¶ | åˆ›å»ºé…ç½®æ–‡ä»¶ |
| `Bash` | æ‰§è¡Œå‘½ä»¤ | è¿è¡Œ `git status` |

### Claude Agent SDK çš„å·¥å…·

Claude Agent SDK æä¾›äº†é¢„ç½®çš„æ ¸å¿ƒå·¥å…·ï¼š

#### 1. Read å·¥å…·
```python
# è®© Agent è¯»å–æ–‡ä»¶
allowed_tools=["Read"]

# Agent å¯ä»¥æ‰§è¡Œç±»ä¼¼æ“ä½œï¼š
# Read(file_path="/path/to/file.txt")
# â†’ è¿”å›æ–‡ä»¶å†…å®¹
```

#### 2. Write å·¥å…·
```python
# è®© Agent å†™å…¥æ–‡ä»¶
allowed_tools=["Write"]

# Agent å¯ä»¥æ‰§è¡Œç±»ä¼¼æ“ä½œï¼š
# Write(file_path="/path/to/new.txt", content="Hello World")
# â†’ åˆ›å»ºæˆ–è¦†ç›–æ–‡ä»¶
```

#### 3. Bash å·¥å…·
```python
# è®© Agent æ‰§è¡Œ Shell å‘½ä»¤
allowed_tools=["Bash"]

# Agent å¯ä»¥æ‰§è¡Œç±»ä¼¼æ“ä½œï¼š
# Bash(command="ls -la")
# â†’ è¿”å›å‘½ä»¤è¾“å‡º
```

### å·¥å…·ç»„åˆ

ä½ å¯ä»¥åŒæ—¶å¯ç”¨å¤šä¸ªå·¥å…·ï¼Œè®© Agent å…·å¤‡æ›´å¼ºå¤§çš„èƒ½åŠ›ï¼š

```python
from claude_agent_sdk import ClaudeAgentOptions

options = ClaudeAgentOptions(
    allowed_tools=["Read", "Write", "Bash"]  # å¯ç”¨æ‰€æœ‰æ ¸å¿ƒå·¥å…·
)
```

---

## å¦‚ä½•å·¥ä½œï¼Ÿ

### å·¥å…·è°ƒç”¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å·¥å…·è°ƒç”¨æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ç”¨æˆ·å‘é€è¯·æ±‚
   "è¯·è¯»å– config.json å¹¶å‘Šè¯‰æˆ‘æ•°æ®åº“é…ç½®"
            â†“
2. Agent åˆ†æè¯·æ±‚
   "ç”¨æˆ·éœ€è¦æ–‡ä»¶å†…å®¹ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨ Read å·¥å…·"
            â†“
3. Agent å‘èµ·å·¥å…·è°ƒç”¨
   Tool: Read
   Input: {"file_path": "config.json"}
            â†“
4. SDK æ‰§è¡Œå·¥å…·
   å®é™…è¯»å–æ–‡ä»¶ï¼Œè¿”å›å†…å®¹
            â†“
5. Agent å¤„ç†ç»“æœ
   "æ–‡ä»¶å†…å®¹æ˜¯ {...}ï¼Œæ•°æ®åº“é…ç½®æ˜¯..."
            â†“
6. è¿”å›æœ€ç»ˆå“åº”
   "æ•°æ®åº“é…ç½®å¦‚ä¸‹ï¼šhost=localhost, port=5432..."
```

### æ¶ˆæ¯ç±»å‹

åœ¨å·¥å…·è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼š

```python
async for message in query("è¯»å– README.md", options=options):
    if message.type == "text":
        # Agent çš„æ–‡å­—å›å¤
        print(f"Agent: {message.text}")
    
    elif message.type == "tool_use":
        # Agent è¯·æ±‚ä½¿ç”¨å·¥å…·
        print(f"å·¥å…·è°ƒç”¨: {message.tool_name}")
        print(f"å‚æ•°: {message.tool_input}")
    
    elif message.type == "tool_result":
        # å·¥å…·æ‰§è¡Œç»“æœ
        print(f"å·¥å…·ç»“æœ: {message.result[:100]}...")
```

### å¤šå·¥å…·åä½œ

Agent å¯ä»¥åœ¨ä¸€æ¬¡ä»»åŠ¡ä¸­è°ƒç”¨å¤šä¸ªå·¥å…·ï¼š

```
ç”¨æˆ·: "æ£€æŸ¥ Git çŠ¶æ€ï¼Œå¦‚æœæœ‰æœªæäº¤çš„æ›´æ”¹ï¼Œå¸®æˆ‘åˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•"

Agent æ‰§è¡Œæµç¨‹:
1. Bash("git status")           â†’ è·å– Git çŠ¶æ€
2. åˆ†æè¾“å‡ºï¼Œå‘ç°æœ‰æ›´æ”¹
3. Write("memo.txt", "...")     â†’ åˆ›å»ºå¤‡å¿˜å½•
4. è¿”å›: "å·²æ£€æŸ¥ Git çŠ¶æ€å¹¶åˆ›å»ºå¤‡å¿˜å½•"
```

---

## æƒé™æ§åˆ¶

### ä¸ºä»€ä¹ˆéœ€è¦æƒé™æ§åˆ¶ï¼Ÿ

âš ï¸ **é‡è¦**ï¼šå·¥å…·èµ‹äºˆäº† Agent çœŸæ­£çš„æ“ä½œèƒ½åŠ›ï¼Œå¿…é¡»è°¨æ…ä½¿ç”¨ï¼š

- `Write` å¯ä»¥è¦†ç›–ä»»ä½•æ–‡ä»¶
- `Bash` å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼ˆåŒ…æ‹¬ `rm -rf`ï¼‰

### permission_mode

Claude Agent SDK æä¾›äº†æƒé™æ¨¡å¼ï¼š

```python
options = ClaudeAgentOptions(
    allowed_tools=["Read", "Write", "Bash"],
    permission_mode='acceptEdits'  # è‡ªåŠ¨æ¥å—æ–‡ä»¶ç¼–è¾‘
)
```

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `'acceptEdits'` | è‡ªåŠ¨æ¥å—æ–‡ä»¶æ“ä½œ | å¼€å‘è°ƒè¯• |
| `'interactive'` | æ¯æ¬¡æ“ä½œéœ€ç¡®è®¤ | ç”Ÿäº§ç¯å¢ƒ |
| è‡ªå®šä¹‰ | ä½¿ç”¨å›è°ƒå‡½æ•° | ç²¾ç»†æ§åˆ¶ |

### can_use_tool å›è°ƒ

ä½¿ç”¨ `can_use_tool` å®ç°ç²¾ç»†æƒé™æ§åˆ¶ï¼š

```python
from claude_agent_sdk import (
    ClaudeAgentOptions,
    PermissionResultAllow,
    PermissionResultDeny
)

async def can_use_tool(tool_name, tool_input, context):
    """è‡ªå®šä¹‰å·¥å…·æƒé™é€»è¾‘"""
    
    # é˜»æ­¢å†™å…¥é‡è¦æ–‡ä»¶
    if tool_name == "Write":
        file_path = tool_input.get("file_path", "")
        if "important" in file_path or ".env" in file_path:
            return PermissionResultDeny(
                behavior="deny",
                message="ä¸èƒ½å†™å…¥æ•æ„Ÿæ–‡ä»¶"
            )
    
    # é˜»æ­¢å±é™©çš„ Bash å‘½ä»¤
    if tool_name == "Bash":
        command = tool_input.get("command", "")
        if "rm -rf" in command:
            return PermissionResultDeny(
                behavior="deny", 
                message="ä¸å…è®¸æ‰§è¡Œå±é™©å‘½ä»¤"
            )
    
    # å…¶ä»–æ“ä½œå…è®¸
    return PermissionResultAllow(behavior="allow")

options = ClaudeAgentOptions(
    allowed_tools=["Read", "Write", "Bash"],
    can_use_tool=can_use_tool
)
```

---

## ä½¿ç”¨åœºæ™¯

### âœ… é€‚åˆä½¿ç”¨å·¥å…·çš„åœºæ™¯

**åœºæ™¯ 1ï¼šä»£ç åˆ†æ**
- ä½¿ç”¨ `Read` è¯»å–æºä»£ç æ–‡ä»¶
- åˆ†æä»£ç ç»“æ„ã€æ‰¾å‡ºé—®é¢˜
- ç¤ºä¾‹ï¼šä»£ç å®¡æŸ¥åŠ©æ‰‹

**åœºæ™¯ 2ï¼šè‡ªåŠ¨åŒ–ä»»åŠ¡**
- ä½¿ç”¨ `Bash` æ‰§è¡Œå¸¸è§å‘½ä»¤
- è‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµ
- ç¤ºä¾‹ï¼šGit æ“ä½œåŠ©æ‰‹

**åœºæ™¯ 3ï¼šæ–‡ä»¶å¤„ç†**
- ä½¿ç”¨ `Read` + `Write` å¤„ç†æ–‡ä»¶
- æ‰¹é‡è½¬æ¢ã€æ ¼å¼åŒ–
- ç¤ºä¾‹ï¼šæ—¥å¿—åˆ†æå™¨

**åœºæ™¯ 4ï¼šé¡¹ç›®åˆå§‹åŒ–**
- ä½¿ç”¨ `Write` åˆ›å»ºæ–‡ä»¶
- ä½¿ç”¨ `Bash` æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤
- ç¤ºä¾‹ï¼šé¡¹ç›®è„šæ‰‹æ¶

### âŒ éœ€è¦è°¨æ…çš„åœºæ™¯

**åœºæ™¯ 1ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
- åŸå› ï¼šæ“ä½œä¸å¯é€†ï¼Œé£é™©é«˜
- å»ºè®®ï¼šHuman-in-the-loopï¼Œæ¯æ­¥ç¡®è®¤

**åœºæ™¯ 2ï¼šæ•æ„Ÿæ•°æ®å¤„ç†**
- åŸå› ï¼šå¯èƒ½æ³„éœ²æˆ–æŸåæ•°æ®
- å»ºè®®ï¼šä½¿ç”¨æƒé™æ§åˆ¶ï¼Œé™åˆ¶è®¿é—®èŒƒå›´

---

## Read vs Write vs Bash

### å¯¹æ¯”è¡¨

| ç»´åº¦ | Read | Write | Bash |
|------|------|-------|------|
| **èƒ½åŠ›** | è¯»å–æ–‡ä»¶ | å†™å…¥æ–‡ä»¶ | æ‰§è¡Œå‘½ä»¤ |
| **é£é™©** | ä½ï¼ˆåªè¯»ï¼‰ | ä¸­ï¼ˆå¯è¦†ç›–ï¼‰ | é«˜ï¼ˆä»»æ„å‘½ä»¤ï¼‰ |
| **å¸¸ç”¨åœºæ™¯** | åˆ†æä»£ç  | ç”Ÿæˆæ–‡ä»¶ | ç³»ç»Ÿæ“ä½œ |
| **éœ€è¦æƒé™** | é€šå¸¸æ— éœ€ | å»ºè®®æ§åˆ¶ | å¿…é¡»æ§åˆ¶ |

### é€‰æ‹©æŒ‡å—

```
éœ€è¦æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Ÿ    â†’ Read
éœ€è¦åˆ›å»º/ä¿®æ”¹æ–‡ä»¶ï¼Ÿ   â†’ Write
éœ€è¦è¿è¡Œç³»ç»Ÿå‘½ä»¤ï¼Ÿ    â†’ Bash
éœ€è¦å¤æ‚æ–‡ä»¶æ“ä½œï¼Ÿ    â†’ Bash (ç”¨ cat, mv, cp ç­‰)
```

---

## æ·±å…¥é˜…è¯»

### å®˜æ–¹èµ„æº
- [Claude Agent SDK - Tools Documentation](https://docs.anthropic.com/agent-sdk/tools)
- [Tool Use Best Practices](https://docs.anthropic.com/claude/docs/tool-use-best-practices)

### ç›¸å…³æ¦‚å¿µ
- **Function Calling**ï¼šå·¥å…·è°ƒç”¨çš„åº•å±‚æœºåˆ¶
- **Agentic Loop**ï¼šAgent çš„å¾ªç¯æ‰§è¡Œæ¨¡å¼
- **Hooks**ï¼šå·¥å…·æ‰§è¡Œå‰åçš„é’©å­å‡½æ•°

---

## å…³é”®è¦ç‚¹æ€»ç»“

âœ… **è®°ä½è¿™äº›**ï¼š
1. **å·¥å…·** = Agent ä¸ç¯å¢ƒäº¤äº’çš„èƒ½åŠ›
2. **ä¸‰å¤§æ ¸å¿ƒå·¥å…·**ï¼šReadï¼ˆè¯»ï¼‰ã€Writeï¼ˆå†™ï¼‰ã€Bashï¼ˆæ‰§è¡Œï¼‰
3. **æƒé™æ§åˆ¶å¾ˆé‡è¦**ï¼šä½¿ç”¨ `can_use_tool` é™åˆ¶å±é™©æ“ä½œ
4. å·¥å…·èµ‹äºˆ Agent çœŸæ­£çš„"è¡ŒåŠ¨åŠ›"

---

## ä¸‹ä¸€æ­¥

âœ… ç†è§£äº†å·¥å…·æ¦‚å¿µåï¼Œè¯·ç»§ç»­é˜…è¯»ï¼š
- **[02_ä»£ç ç¤ºä¾‹.md](02_ä»£ç ç¤ºä¾‹.md)** - åŠ¨æ‰‹å†™ä»£ç ï¼Œä½¿ç”¨è¿™äº›å·¥å…·
- **[03_æœ€ä½³å®è·µ.md](03_æœ€ä½³å®è·µ.md)** - å­¦ä¹ å®‰å…¨å’Œæœ€ä½³å®è·µ

ğŸ—ï¸ **å®æˆ˜é¡¹ç›®**ï¼š
å‰å¾€ [projects/project_01_file_analyzer](../projects/project_01_file_analyzer/) å®ç°ä½ çš„ç¬¬ä¸€ä¸ªå·¥å…·è°ƒç”¨é¡¹ç›®ï¼
