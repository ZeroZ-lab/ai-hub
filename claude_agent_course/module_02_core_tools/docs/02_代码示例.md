# Module 2 - ä»£ç ç¤ºä¾‹ï¼šæ ¸å¿ƒå·¥å…·å®æˆ˜

> æœ¬æ–‡æ¡£æä¾›å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŒæ¡ Claude Agent SDK çš„æ ¸å¿ƒå·¥å…·ä½¿ç”¨ã€‚

## ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… Claude Agent SDK

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd your_project

# ä½¿ç”¨ uv å®‰è£…ï¼ˆæ¨èï¼‰
uv add claude-agent-sdk python-dotenv

# æˆ–ä½¿ç”¨ pip
pip install claude-agent-sdk python-dotenv
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»º .env æ–‡ä»¶
touch .env

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰
echo 'ANTHROPIC_API_KEY=sk-ant-api03-ä½ çš„å¯†é’¥' >> .env

# å¦‚æœä½¿ç”¨è‡ªå®šä¹‰ API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
# echo 'ANTHROPIC_BASE_URL=https://api.your-service.com/v1' >> .env
```

### 3. éªŒè¯å®‰è£…

```python
# test_install.py
from claude_agent_sdk import query, ClaudeAgentOptions

print("âœ… Claude Agent SDK å®‰è£…æˆåŠŸï¼")
print(f"å¯ç”¨é€‰é¡¹: {dir(ClaudeAgentOptions)}")
```

```bash
uv run python test_install.py
```

---

## æœ€ç®€ç¤ºä¾‹ï¼šè¯»å–æ–‡ä»¶

### Hello Tools

åˆ›å»ºæ–‡ä»¶ `hello_tools.py`ï¼š

```python
"""
Hello Tools: æœ€ç®€å•çš„å·¥å…·è°ƒç”¨ç¤ºä¾‹
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def main():
    """ä½¿ç”¨ Read å·¥å…·è¯»å–æ–‡ä»¶"""
    
    # é…ç½®é€‰é¡¹ï¼šå¯ç”¨ Read å·¥å…·
    options = ClaudeAgentOptions(
        allowed_tools=["Read"],
        permission_mode='acceptEdits'  # å¼€å‘æ¨¡å¼ï¼Œè‡ªåŠ¨æ¥å—
    )
    
    # å‘é€è¯·æ±‚
    print("ğŸ” è¯·æ±‚ Agent è¯»å– README.md...")
    
    async for message in query(
        prompt="è¯·è¯»å– README.md æ–‡ä»¶ï¼Œå‘Šè¯‰æˆ‘è¿™ä¸ªé¡¹ç›®æ˜¯åšä»€ä¹ˆçš„",
        options=options
    ):
        if hasattr(message, 'text'):
            print(f"\nğŸ“ Agent: {message.text}")
        elif hasattr(message, 'tool_name'):
            print(f"ğŸ”§ å·¥å…·è°ƒç”¨: {message.tool_name}")

if __name__ == "__main__":
    asyncio.run(main())
```

**è¿è¡Œ**ï¼š
```bash
uv run python hello_tools.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ” è¯·æ±‚ Agent è¯»å– README.md...
ğŸ”§ å·¥å…·è°ƒç”¨: Read
ğŸ“ Agent: è¿™æ˜¯ä¸€ä¸ª Claude Agent SDK å­¦ä¹ è¯¾ç¨‹é¡¹ç›®...
```

---

## æ ¸å¿ƒç¤ºä¾‹ 1ï¼šæ–‡ä»¶è¯»å–ä¸åˆ†æ

### è¯»å–å¹¶åˆ†æé…ç½®æ–‡ä»¶

```python
"""
ç¤ºä¾‹ï¼šè¯»å–é…ç½®æ–‡ä»¶å¹¶åˆ†æ
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def analyze_config():
    """è¯»å–é…ç½®æ–‡ä»¶å¹¶åˆ†æå…¶å†…å®¹"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Read"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š
    1. è¯»å– pyproject.toml æ–‡ä»¶
    2. å‘Šè¯‰æˆ‘è¿™ä¸ªé¡¹ç›®çš„åç§°ã€ç‰ˆæœ¬å’Œä¾èµ–
    3. å¦‚æœæœ‰é—®é¢˜ï¼Œç»™å‡ºæ”¹è¿›å»ºè®®
    """
    
    print("ğŸ“‚ åˆ†æé¡¹ç›®é…ç½®...")
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)
        elif hasattr(message, 'tool_name'):
            print(f"\nâš™ï¸ æ­£åœ¨ä½¿ç”¨ {message.tool_name}...")

asyncio.run(analyze_config())
```

### æ‰¹é‡è¯»å–å¤šä¸ªæ–‡ä»¶

```python
"""
ç¤ºä¾‹ï¼šæ‰¹é‡è¯»å–æ–‡ä»¶
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def batch_read():
    """è®© Agent è¯»å–å¤šä¸ªæ–‡ä»¶å¹¶ç”ŸæˆæŠ¥å‘Š"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Read"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š
    1. è¯»å– src/ ç›®å½•ä¸‹çš„æ‰€æœ‰ .py æ–‡ä»¶
    2. ç»Ÿè®¡æ¯ä¸ªæ–‡ä»¶çš„è¡Œæ•°
    3. ç”Ÿæˆä¸€ä¸ªç®€å•çš„ä»£ç ç»Ÿè®¡æŠ¥å‘Š
    """
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)

asyncio.run(batch_read())
```

---

## æ ¸å¿ƒç¤ºä¾‹ 2ï¼šæ–‡ä»¶å†™å…¥ä¸åˆ›å»º

### åˆ›å»ºé…ç½®æ–‡ä»¶

```python
"""
ç¤ºä¾‹ï¼šåˆ›å»ºé…ç½®æ–‡ä»¶
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def create_config():
    """ç”Ÿæˆé…ç½®æ–‡ä»¶"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Write"],
        permission_mode='acceptEdits'  # è‡ªåŠ¨æ¥å—å†™å…¥
    )
    
    prompt = """
    è¯·åˆ›å»ºä¸€ä¸ª config.json æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ï¼š
    - app_name: "MyAgent"
    - version: "1.0.0"
    - debug: true
    - log_level: "info"
    """
    
    print("ğŸ“ åˆ›å»ºé…ç½®æ–‡ä»¶...")
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)
        elif hasattr(message, 'tool_name'):
            print(f"âœï¸ æ­£åœ¨å†™å…¥æ–‡ä»¶...")

asyncio.run(create_config())
```

### ç”Ÿæˆé¡¹ç›®æ–‡ä»¶

```python
"""
ç¤ºä¾‹ï¼šè®© Agent ç”Ÿæˆå¤šä¸ªé¡¹ç›®æ–‡ä»¶
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def scaffold_project():
    """ç”Ÿæˆé¡¹ç›®è„šæ‰‹æ¶"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Write"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·åœ¨ output/ ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç®€å•çš„ Python é¡¹ç›®ç»“æ„ï¼š
    1. output/__init__.py - ç©ºæ–‡ä»¶
    2. output/main.py - åŒ…å«ä¸€ä¸ª hello world å‡½æ•°
    3. output/utils.py - åŒ…å«ä¸€ä¸ªæ—¥æœŸæ ¼å¼åŒ–å‡½æ•°
    """
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)

asyncio.run(scaffold_project())
```

---

## æ ¸å¿ƒç¤ºä¾‹ 3ï¼šBash å‘½ä»¤æ‰§è¡Œ

### æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

```python
"""
ç¤ºä¾‹ï¼šæ‰§è¡Œ Bash å‘½ä»¤
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def run_bash():
    """æ‰§è¡Œç³»ç»Ÿå‘½ä»¤è·å–ä¿¡æ¯"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Bash"],
        permission_mode='acceptEdits'
    )
    
    prompt = "è¯·æ‰§è¡Œ ls -la å‘½ä»¤ï¼Œå‘Šè¯‰æˆ‘å½“å‰ç›®å½•æœ‰å“ªäº›æ–‡ä»¶"
    
    print("ğŸ’» æ‰§è¡Œç³»ç»Ÿå‘½ä»¤...")
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)
        elif hasattr(message, 'tool_name'):
            print(f"âš¡ æ‰§è¡Œå‘½ä»¤...")

asyncio.run(run_bash())
```

### Git çŠ¶æ€æ£€æŸ¥

```python
"""
ç¤ºä¾‹ï¼šæ£€æŸ¥ Git çŠ¶æ€
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def check_git():
    """æ£€æŸ¥ Git ä»“åº“çŠ¶æ€"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Bash"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
    1. è¿è¡Œ git status æŸ¥çœ‹ä»“åº“çŠ¶æ€
    2. è¿è¡Œ git log -3 --oneline æŸ¥çœ‹æœ€è¿‘3æ¬¡æäº¤
    3. ç”¨ä¸­æ–‡æ€»ç»“ä»“åº“å½“å‰çŠ¶æ€
    """
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)

asyncio.run(check_git())
```

### ç¯å¢ƒæ£€æŸ¥

```python
"""
ç¤ºä¾‹ï¼šæ£€æŸ¥å¼€å‘ç¯å¢ƒ
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def check_environment():
    """æ£€æŸ¥å¼€å‘ç¯å¢ƒé…ç½®"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Bash"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·æ£€æŸ¥æˆ‘çš„å¼€å‘ç¯å¢ƒï¼š
    1. Python ç‰ˆæœ¬ (python --version)
    2. Node.js ç‰ˆæœ¬ (node --version)
    3. Git ç‰ˆæœ¬ (git --version)
    4. åˆ—å‡ºå·²å®‰è£…çš„ Python åŒ… (uv pip list æˆ– pip list)
    
    è¯·ç”¨å‹å¥½çš„æ–¹å¼å‘Šè¯‰æˆ‘ç¯å¢ƒçŠ¶æ€ã€‚
    """
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)

asyncio.run(check_environment())
```

---

## å®Œæ•´ç¤ºä¾‹ï¼šç»„åˆä½¿ç”¨å¤šä¸ªå·¥å…·

### é¡¹ç›®åˆ†æå™¨

```python
"""
å®Œæ•´ç¤ºä¾‹ï¼šé¡¹ç›®åˆ†æå™¨
ç»„åˆä½¿ç”¨ Read å’Œ Bash å·¥å…·åˆ†æé¡¹ç›®
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def analyze_project():
    """åˆ†æé¡¹ç›®ç»“æ„å’Œä»£ç """
    
    # å¯ç”¨å¤šä¸ªå·¥å…·
    options = ClaudeAgentOptions(
        allowed_tools=["Read", "Bash"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·å¯¹å½“å‰é¡¹ç›®è¿›è¡Œå…¨é¢åˆ†æï¼š
    
    1. ä½¿ç”¨ Bash æ‰§è¡Œ find . -name "*.py" -type f æ‰¾å‡ºæ‰€æœ‰ Python æ–‡ä»¶
    2. è¯»å–æœ€é‡è¦çš„å‡ ä¸ª Python æ–‡ä»¶
    3. åˆ†æé¡¹ç›®ç»“æ„å’Œä»£ç é£æ ¼
    4. ç”Ÿæˆä¸€ä»½é¡¹ç›®åˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
       - é¡¹ç›®ç±»å‹ï¼ˆWebåº”ç”¨ã€CLIå·¥å…·ã€åº“ç­‰ï¼‰
       - ä¸»è¦åŠŸèƒ½
       - ä»£ç è´¨é‡è¯„ä¼°
       - æ”¹è¿›å»ºè®®
    """
    
    print("ğŸ” æ­£åœ¨åˆ†æé¡¹ç›®...\n")
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)
        elif hasattr(message, 'tool_name'):
            print(f"ğŸ“Œ {message.tool_name}: {message.tool_input}")

asyncio.run(analyze_project())
```

### è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆå™¨

```python
"""
å®Œæ•´ç¤ºä¾‹ï¼šè‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆå™¨
ç»„åˆä½¿ç”¨ Readã€Write å’Œ Bash å·¥å…·
"""

import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def generate_report():
    """ç”Ÿæˆé¡¹ç›®æŠ¥å‘Š"""
    
    options = ClaudeAgentOptions(
        allowed_tools=["Read", "Write", "Bash"],
        permission_mode='acceptEdits'
    )
    
    prompt = """
    è¯·ç”Ÿæˆä¸€ä»½é¡¹ç›®æŠ¥å‘Šï¼š
    
    1. æ‰§è¡Œ git log --oneline -10 è·å–æœ€è¿‘æäº¤
    2. è¯»å– README.md äº†è§£é¡¹ç›®æ¦‚è¿°
    3. æ‰§è¡Œ wc -l src/*.py ç»Ÿè®¡ä»£ç è¡Œæ•°
    4. å°†ä»¥ä¸Šä¿¡æ¯æ•´ç†æˆä¸€ä»½ Markdown æŠ¥å‘Š
    5. å°†æŠ¥å‘Šä¿å­˜ä¸º PROJECT_REPORT.md
    
    æŠ¥å‘Šåº”åŒ…å«ï¼šé¡¹ç›®ç®€ä»‹ã€æœ€è¿‘æ›´æ–°ã€ä»£ç ç»Ÿè®¡
    """
    
    print("ğŸ“Š æ­£åœ¨ç”Ÿæˆé¡¹ç›®æŠ¥å‘Š...\n")
    
    async for message in query(prompt=prompt, options=options):
        if hasattr(message, 'text'):
            print(message.text)

asyncio.run(generate_report())
```

---

## æƒé™æ§åˆ¶ç¤ºä¾‹

### ä½¿ç”¨ can_use_tool å›è°ƒ

```python
"""
ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å·¥å…·æƒé™
"""

import asyncio
from claude_agent_sdk import (
    query, 
    ClaudeAgentOptions,
    ToolPermissionContext,
    PermissionResultAllow,
    PermissionResultDeny
)

async def can_use_tool(tool_name: str, tool_input: dict, context: ToolPermissionContext):
    """è‡ªå®šä¹‰æƒé™æ£€æŸ¥"""
    
    # é˜»æ­¢å†™å…¥æ•æ„Ÿæ–‡ä»¶
    if tool_name == "Write":
        file_path = tool_input.get("file_path", "")
        sensitive_patterns = [".env", "config", "secret", "password"]
        
        if any(p in file_path.lower() for p in sensitive_patterns):
            print(f"âš ï¸ é˜»æ­¢å†™å…¥æ•æ„Ÿæ–‡ä»¶: {file_path}")
            return PermissionResultDeny(
                behavior="deny",
                message=f"ä¸å…è®¸å†™å…¥æ•æ„Ÿæ–‡ä»¶: {file_path}"
            )
    
    # é˜»æ­¢å±é™©çš„ Bash å‘½ä»¤
    if tool_name == "Bash":
        command = tool_input.get("command", "")
        dangerous_patterns = ["rm -rf", "sudo", "chmod 777", "> /dev"]
        
        if any(p in command for p in dangerous_patterns):
            print(f"âš ï¸ é˜»æ­¢å±é™©å‘½ä»¤: {command}")
            return PermissionResultDeny(
                behavior="deny",
                message=f"ä¸å…è®¸æ‰§è¡Œå±é™©å‘½ä»¤"
            )
    
    # è®°å½•æ‰€æœ‰å·¥å…·ä½¿ç”¨
    print(f"âœ… å…è®¸: {tool_name}")
    return PermissionResultAllow(behavior="allow")

async def main():
    options = ClaudeAgentOptions(
        allowed_tools=["Read", "Write", "Bash"],
        can_use_tool=can_use_tool
    )
    
    # æµ‹è¯•: è¿™ä¸ªæ“ä½œä¼šè¢«å…è®¸
    async for msg in query("è¯»å– README.md", options=options):
        if hasattr(msg, 'text'):
            print(msg.text)
    
    print("\n" + "="*50 + "\n")
    
    # æµ‹è¯•: è¿™ä¸ªæ“ä½œä¼šè¢«é˜»æ­¢
    async for msg in query("åˆ›å»º .env.backup æ–‡ä»¶", options=options):
        if hasattr(msg, 'text'):
            print(msg.text)

asyncio.run(main())
```

---

## å¸¸è§ç”¨æ³•å¯¹æ¯”

### âœ… å¥½çš„å®è·µ vs âŒ ä¸å¥½çš„å®è·µ

#### 1. å·¥å…·é€‰æ‹©

```python
# âŒ ä¸å¥½ï¼šå¯ç”¨æ‰€æœ‰å·¥å…·ä½†ä¸æ§åˆ¶
options = ClaudeAgentOptions(
    allowed_tools=["Read", "Write", "Bash"]
    # æ²¡æœ‰æƒé™æ§åˆ¶ï¼
)

# âœ… å¥½ï¼šåªå¯ç”¨éœ€è¦çš„å·¥å…·
options = ClaudeAgentOptions(
    allowed_tools=["Read"],  # åªè¯»æ“ä½œ
    permission_mode='acceptEdits'
)

# âœ… æ›´å¥½ï¼šæœ‰æƒé™æ§åˆ¶
options = ClaudeAgentOptions(
    allowed_tools=["Read", "Write", "Bash"],
    can_use_tool=my_permission_checker
)
```

#### 2. é”™è¯¯å¤„ç†

```python
# âŒ ä¸å¥½ï¼šæ²¡æœ‰é”™è¯¯å¤„ç†
async for msg in query(prompt, options):
    print(msg.text)

# âœ… å¥½ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†
try:
    async for msg in query(prompt, options):
        if hasattr(msg, 'text'):
            print(msg.text)
        elif hasattr(msg, 'error'):
            print(f"é”™è¯¯: {msg.error}")
except Exception as e:
    print(f"æŸ¥è¯¢å¤±è´¥: {e}")
    # å®ç°é™çº§æ–¹æ¡ˆ
```

---

## API å‚è€ƒå¿«æŸ¥

### ClaudeAgentOptions ä¸»è¦é€‰é¡¹

```python
options = ClaudeAgentOptions(
    # å·¥å…·ç›¸å…³
    allowed_tools=["Read", "Write", "Bash"],  # å…è®¸çš„å·¥å…·
    permission_mode='acceptEdits',             # æƒé™æ¨¡å¼
    can_use_tool=my_callback,                  # æƒé™å›è°ƒ
    
    # æ¨¡å‹ç›¸å…³
    model="claude-sonnet-4-20250514",              # æ¨¡å‹é€‰æ‹©
    max_tokens=4096,                           # æœ€å¤§è¾“å‡º
    
    # å…¶ä»–
    cwd="/path/to/project",                    # å·¥ä½œç›®å½•
)
```

### æ¶ˆæ¯ç±»å‹

```python
async for message in query(prompt, options):
    # æ–‡æœ¬æ¶ˆæ¯
    if message.type == "text":
        text = message.text
    
    # å·¥å…·è°ƒç”¨
    elif message.type == "tool_use":
        tool_name = message.tool_name
        tool_input = message.tool_input
    
    # å·¥å…·ç»“æœ
    elif message.type == "tool_result":
        result = message.result
```

---

## è°ƒè¯•æŠ€å·§

### 1. æ‰“å°æ‰€æœ‰æ¶ˆæ¯

```python
async for message in query(prompt, options):
    print(f"æ¶ˆæ¯ç±»å‹: {type(message)}")
    print(f"æ¶ˆæ¯å†…å®¹: {message}")
    print("-" * 40)
```

### 2. è¿½è¸ªå·¥å…·è°ƒç”¨

```python
tool_calls = []

async for message in query(prompt, options):
    if hasattr(message, 'tool_name'):
        tool_calls.append({
            'tool': message.tool_name,
            'input': message.tool_input
        })
    if hasattr(message, 'text'):
        print(message.text)

print(f"\nå·¥å…·è°ƒç”¨è®°å½•: {tool_calls}")
```

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: å·¥å…·è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ˜¯å¦æœ‰æ‰§è¡Œæƒé™
3. ä½¿ç”¨ try-except æ•è·é”™è¯¯

```python
try:
    async for msg in query("è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶.txt", options):
        print(msg)
except Exception as e:
    print(f"å·¥å…·è°ƒç”¨å¤±è´¥: {e}")
```

### Q2: å¦‚ä½•é™åˆ¶ Bash å¯æ‰§è¡Œçš„å‘½ä»¤ï¼Ÿ

ä½¿ç”¨ `can_use_tool` å›è°ƒè¿›è¡Œè¿‡æ»¤ï¼š

```python
ALLOWED_COMMANDS = ["ls", "cat", "pwd", "echo", "git"]

async def can_use_tool(tool_name, tool_input, context):
    if tool_name == "Bash":
        command = tool_input.get("command", "")
        # åªå…è®¸ç™½åå•ä¸­çš„å‘½ä»¤
        if not any(command.startswith(cmd) for cmd in ALLOWED_COMMANDS):
            return PermissionResultDeny(behavior="deny", message="å‘½ä»¤ä¸åœ¨ç™½åå•ä¸­")
    return PermissionResultAllow(behavior="allow")
```

### Q3: å¦‚ä½•åœ¨åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ

```python
import asyncio

def sync_query(prompt, options):
    """åŒæ­¥åŒ…è£…å™¨"""
    async def _run():
        results = []
        async for msg in query(prompt, options):
            results.append(msg)
        return results
    
    return asyncio.run(_run())

# ä½¿ç”¨
results = sync_query("è¯»å– README.md", options)
```

---

## ä¸‹ä¸€æ­¥

âœ… æŒæ¡äº†ä»£ç ç¤ºä¾‹åï¼š
- é˜…è¯» **[03_æœ€ä½³å®è·µ.md](03_æœ€ä½³å®è·µ.md)** - å­¦ä¹ å®‰å…¨æ€§å’Œæœ€ä½³å®è·µ
- å®Œæˆ **[project_01_file_analyzer](../projects/project_01_file_analyzer/)** - å®æˆ˜é¡¹ç›®

ğŸ’¡ **å»ºè®®**ï¼š
1. å…ˆè¿è¡Œæ‰€æœ‰ç¤ºä¾‹ä»£ç ï¼Œç¡®ä¿èƒ½è·‘é€š
2. å°è¯•ä¿®æ”¹å·¥å…·ç»„åˆï¼Œè§‚å¯Ÿæ•ˆæœå˜åŒ–
3. å®ç°è‡ªå·±çš„æƒé™æ§åˆ¶é€»è¾‘

---

**å¼€å§‹ç¼–ç å§ï¼ğŸš€**
