# 01. Agent 架构模式：从指令执行到自主规划

> "Agent 不仅仅是调用工具，它是一个不断感知、推理和行动的循环系统。"

## 1. 什么是 ReAct？

ReAct (Reasoning + Acting) 是最经典的 Agent 模式。它结合了 LLM 的**推理能力 (Reasoning)** 和 **行动能力 (Acting)**。

### 核心循环
1. **Thought (思考)**: Agent 分析当前情况，决定下一步做什么。
2. **Action (行动)**: Agent 决定调用某个工具及其参数。
3. **Observation (观察)**: 执行工具，获取结果。
4. **Repeat (重复)**: 将观察结果带回第一步，继续思考。

### 示例 Prompt 结构
一个 ReAct Agent 的系统提示词通常长这样：

```text
Answer the following questions as best you can. You have access to the following tools:

{tools}

Use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question
```

### 为什么 ReAct 很重要？
- **鲁棒性**: 允许 Agent 看到工具执行失败后尝试新的策略（自我纠错）。
- **可解释性**: 我们可以看到 Agent 的思考过程 (Thought)，知道它为什么这么做。

---

## 2. Chain of Thought (CoT)

思维链 (CoT) 是 ReAct 的基础。即使不调用工具，让模型在回答前"深呼吸，一步步思考"，也能显著提高复杂任务的准确率。

在 Claude 中，我们通常使用 XML 标签来引导 CoT：

```xml
<system>
你是一个帮助用户解决复杂数学问题的助手。
在回答之前，请在 <thinking> 标签中一步步写下你的推理过程。
</system>
```

---

## 3. Planning (规划)

对于非常复杂的任务（例如"策划一场 7 天的日本旅行"），简单的 ReAct 循环可能会迷失方向。这时我们需要显式的 **Planning** 步骤。

### Plan-and-Solve 模式
1. **Planner**: 首先生成一个高层次的计划列表（Step 1, Step 2, ...）。
2. **Executor**: 逐个执行计划中的步骤。
3. **Replanner (Optional)**: 如果遇到意外，更新剩余的计划。

### 示例流程
**任务**: "帮我研究特斯拉的最新财报并写一篇博客。"

1.  **Plan**:
    -   1. 搜索特斯拉最新财报发布日期。
    -   2. 获取财报核心数据（营收、利润、交付量）。
    -   3. 搜索市场分析师的评价。
    -   4. 撰写博客草稿。
2.  **Execute Step 1**: ...
3.  **Execute Step 2**: ...
    ...

---

## 4. 架构对比

| 模式 | 描述 | 适用场景 | 复杂度 |
| :--- | :--- | :--- | :--- |
| **Zero-shot** | 直接回答，无工具 | 简单问答 | ⭐ |
| **Function Calling** | 单次工具调用 | 明确的单一任务 | ⭐⭐ |
| **ReAct** | 思考-行动-观察循环 | 需要多步推理的任务 | ⭐⭐⭐ |
| **Plan-and-Solve** | 先规划后执行 | 复杂长程任务 | ⭐⭐⭐⭐ |
| **Orchestrator** | 多 Agent 协作 | 极其复杂的综合系统 | ⭐⭐⭐⭐⭐ |

在接下来的项目中，我们将亲手实现这些模式！
